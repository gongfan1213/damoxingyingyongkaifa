输出：合肥市今天的天气状况为晴，温度范围在22℃~33℃，风向与风力分别为西北风和微风。针对今晚的舞会，建议选择一双舒适、透气且有良好排汗性能的鞋子，如网面运动鞋或透气性好的轻便休闲鞋。 

提示工程上手相对简单，不需要采集与构建数据集，更不需要微调或训练大模型，刚接触大模型时可以采用这种方式来快速体验和应用。

### 2.5.1 提示工程开发流程

大模型通过简单的提示可以实现多种应用效果，但其质量取决于提供的信息量以及提示的精心设计程度。大模型的能力虽然强大，利用较少的输入也可以生成内容，但随意的输入可能产生无效或错误的输出。

高质量的提示需要清晰、具体、聚焦、简洁。其中，“清晰”是指问题避免复杂或歧义，术语定义明确；“具体”是指问题描述具体，避免模棱两可；“聚焦”是指避免问题过于宽泛或开放；“简洁”是指问题表述简洁。

通过系统设计提示，规范模型的输入/输出方式，企业能够快速得到更准确和实用的结果。通过对提示进行工程化处理，可以增强模型的生成效果、减少错误输出，应用大模型高效满足特定领域任务的需求。提示工程开发流程如图2-27所示。


![image](https://github.com/user-attachments/assets/0938b3f8-34c7-4c28-ba48-e314431bf939)



**图2-27 提示工程开发流程**

展示了从目标确定，到提示设计、大模型处理、评估输出、提示优化，再到部署验证的循环流程 。



1. **目标**：确定优化任务和目标是指需要明确所需的任务类型和预期的生成结果，可以是问题回答、文本摘要、对话生成等。目标确定之后，需要进一步收集和分析数据，了解任务需求和数据特点，寻找典型示例样本，从而更好地设计与优化提示的内容和设置。

2. **提示设计**：设计的提示内容能够清晰、明确地引导大模型生成所需的内容，并避免生成模糊或引起误导的表达。

3. **评估输出**：用于评估大模型生成的结果，判断是否符合要求。

4. **提示优化**：根据实际需求和生成结果的效果调整提示设置，进行更多的试验和优化，以得到最佳的生成结果。 

5. **部署验证**：将优化后的提示进行部署验证，供其他用户使用。




提示工程成为持续优化大模型应用的基本方法。通过构建提示库并不断更新，技术人员能够在不同场景中重复使用这些提示，再将用户的开放式输入封装到提示中传给大模型，使大模型输出更相关、更准确的内容，避免用户反复试验，从而提升体验。

任务的复杂度决定了提示工程的技术方案选择。简单任务可以用零样本提示、少样本提示的方式，不提供或提供少量示例给模型，让模型能快速输出结果，比如对某个文本进行正面或负面的评判。复杂任务则大多需要拆解为若干步骤、提供更多示例，采取思维链提示等方式，让模型能逐步推理出更精准的结果，例如对一个复杂的工程问题进行数学求解。

经过调整和优化后的提示内容用于引导模型生成所需的特定内容、控制输出的风格和语气、提高输出的准确性和可靠性、减少生成过程的迭代和修正，获得应用于任务场景中的更准确、更相关的生成结果，并进一步积累优化经验，指导更多提示设计和优化工作。


### 2.5.2 提示设计开发
优质提示的设计开发主要有两种方式：一种是根据需求正向编写提示，随后基于大模型生成的结果来优化提示；另一种是根据既定的结果，让大模型逆向生成提示，随后在此基础上完善，如图2-28所示。优质提示的结构主要包括上下文重置、背景设定、任务下发、任务细节描述、输出控制、任务确认，共6个模块。

**图2-28 提示设计开发流程**

展示了提示开发各模块（上下文重置、背景设定等 ）与大模型交互，以及提示优化、提示逆向的流程。


![image](https://github.com/user-attachments/assets/863210f3-08d5-46b0-b4a5-2215b6678925)




1. **上下文重置**：是指清除之前的对话或信息，确保下一个提示从一个“干净”的状态开始。这样可以尽量避免干扰，确保每个提示都从相同的起点开始生成回应。

2. **背景设定**：是指为模型提供有关对话或任务的背景信息，包括对话参与者的身份、场景的描述、对话的历史背景等，提供背景设定可以帮助大模型理解上下文并更准确地生成回复。 

3. **任务下发**：是指明确指示大模型需要完成的任务或目标，包括要生成的特定文本类型（如问题回答、文章摘要等），或对待生成文本的要求和限制（例如需要回答所有问题、回答的字数要求等）。 

4. **任务细节描述**：是指提供更具体的任务说明，以便大模型可以更好地理解和满足要求，包括对生成文本内容的要求、期望的输出模式，以及对特定领域知识的要求等。 

5. **输出控制**：指导模型生成输出的方式和形式，包括对生成文本的风格、格式（如表格、Markdown等）的要求。 

6. **任务确认**：是指和模型确认是否理解任务，大模型可以通过提问、澄清疑惑或建议修改，来确保它正确地理解了任务，并为最终输出做好准备。




其中，任务下发和任务细节描述是重点模块。模块内容组合可以有效地指导模型生成更准确、有针对性的回复，以满足特定领域任务或需求。

示例如下：(上下文重置) 请忽略之前的提示。(背景设定) 你是一位经验丰富的自由撰稿人，在技术行业拥有高水平的专业知识。你的主要工作是为网站、媒体、广告撰写要发布的内容。(任务下发) 接下来，根据以下撰稿主题，输出一篇引人入胜的文章。(任务细节) 要求既具有丰富的信息、友好性和吸引力，又包含幽默和现实生活实例。(输出控制) 输出的文章采用Markdown格式。(任务确认) 你明白了吗？如无问题，我将开始输入。


#### 1. 常用技巧

优质提示开发的常用技巧包括角色扮演法、提供示例法、分步思考法、知识注入法、逆向提示法，如图2-29所示。

![image](https://github.com/user-attachments/assets/e75ab4e6-f9f2-4105-90db-4b578f319fdc)



**图2-29 提示开发常用技巧**

展示了5个技巧（角色扮演法、提供示例法、分步思考法、知识注入法、逆向提示法 ）。



**（1）角色扮演法**

角色扮演法通过将大模型置于特定角色的位置上，可以引导大模型从该角色的视角来理解和解决具体问题，能够基于特定背景知识提供更准确和相关度高的答案。

- **示例1**：扮演脱口秀演员。“你是一名优秀的脱口秀喜剧演员，对任务有任何不明白的地方都会先问清楚再工作。每次创作脱口秀节目内容前，你会询问节目的主题，然后利用自己的机智、创造力和观察力，基于主题编写脱口秀喜剧节目台本，并在节目中加入个人的趣闻轶事或经历。你明白吗？如无问题，请开始创作。” 

- **示例2**：扮演业务负责人。“作为水资源利用部门的负责人，我的核心任务是确保水资源供应的可靠性和持续性，以满足人类和生态系统的需求。这一目标不仅包括提供足够的饮用水、灌溉水和工业用水等，还涉及支持社会经济发展。为实现这些目标，我们需要制定一系列业务核心指标。请列出指标名称、指标说明和指标计算公式。” 



**（2）提供示例法**

提供示例法帮助大模型明确预期输出，大模型通过示例可以了解需求，生成与示例一致、相关和有价值的文本输出，并且示例能起到控制生成文本风格和格式的作用。

- **示例**：以下哪种方式回家更快？

  - 选项1：坐10分钟公交车，然后骑30分钟的自行车，最后坐40分钟的火车。

  - 选项2：坐90分钟火车，然后骑20分钟自行车，最后坐10分钟公交车。
  - 选项1需要时间：10分钟 + 30分钟 + 40分钟 = 80分钟，即共需80分钟。
  - 选项2需要时间：90分钟 + 20分钟 + 10分钟 = 120分钟。
  - 因为选项1共需80分钟，选项2共需120分钟，所以选项1更快。
请参考上面例子的计算逻辑，回答采用下面哪种交通方式上班更快？
  - 选项1：乘坐60分钟公交车，然后乘坐半小时的火车，最后骑自行车10分钟。
  - 选项2：乘坐40分钟公交车，然后乘坐一小时的火车，最后骑自行车30分钟。
  - （回答略。）

**（3）分步思考法**

分步思考法有助于模型深入理解问题及其解决方案，将问题分解为可逐步解决的子问题，引导大模型一步步生成相关内容，有助于消除大模型对问题的误解，避免歧义。
- **示例1**：如果小飞有5个苹果，然后吃掉了2个，送给他的朋友2个，再买5个，朋友给了小飞1个，然后小飞又送给他的朋友3个，小飞现在还剩几个苹果呢？回答之前先一步步检查一遍计算数值是否正确，没问题后再输出答案。（回答略。）
- **示例2**：请忽略之前的提示。你是一位软件开发工程师，对任务你有任何不明白的地方都会先问清楚再工作。帮我实现音频采样率的转换功能，具体要求如下：①基于C++实现48000Hz到16000Hz的音频采样率转换功能；②给出详细步骤和代码实现。输出请使用Markdown语法，代码保留必要的注释。你明白吗？如无问题，请执行任务。

**（4）知识注入法**

知识注入法通过将相关领域的知识注入模型中，可以弥补模型的特定领域知识不足的缺陷，并改善文本生成的质量和准确性。
- **示例1**：十二时辰是中国古代的一种划分时间的方式，将一天分为12个时辰。每个时辰对应现代时间的两小时。下面是关于十二时辰的一些知识：十二时辰的划分是基于太阳的升起和落下，每个时辰的实际长度并不相等，而是根据不同季节的白天和黑夜的时长变化而有所变化。十二时辰的起始时间是在夜晚子时。子时是晚上11点至凌晨1点之间。十二时辰的名称分别是子时、丑时、寅时、卯时、辰时、巳时、午时、未时、申时、酉时、戌时、亥时。

请结合示例1中的十二时辰知识，回答以下问题：一天有多少个时辰，寅时是一天中的什么时间段？在十二个时辰中排第几？
  - 输出：十二时辰是中国古代的一种划分时间的方式，将一天分为12个时辰。寅时是一天中的凌晨3点到4点59分这个时间段。在12个时辰中排第3。
- **示例2**：请学习以下知识。

“第一百三十三条之二【妨害安全驾驶罪】对行驶中的公共交通工具的驾驶人员使用暴力或者抢控驾驶操纵装置，干扰公共交通工具正常行驶，危及公共安全的，处一年以下有期徒刑、拘役或者管制，并处或者单处罚金。

前款规定的驾驶人员在行驶的公共交通工具上擅离职守，与他人互殴或者殴打他人，危及公共安全的，依照前款的规定处罚。

有前两款行为，同时构成其他犯罪的，依照处罚较重的规定定罪处罚。”

请抽取该知识的罪名、行为、处罚相关实体，不用输出，根据抽取的实体以(实体，关系，实体)的格式输出三元组。

  - 输出：
  
    - (妨害安全驾驶罪，行为，对行驶中的公共交通工具的驾驶人员使用暴力或者抢控驾驶操纵装置)
    - (妨害安全驾驶罪，行为，干扰公共交通工具正常行驶)
    - (妨害安全驾驶罪，行为，危及公共安全)
    - (妨害安全驾驶罪，处罚，一年以下有期徒刑、拘役或者管制)
    - (妨害安全驾驶罪，处罚，罚金)
    - (妨害安全驾驶罪，行为，在行驶的公共交通工具上擅离职守)
    - (妨害安全驾驶罪，行为，与他人互殴或者殴打他人)
    - (妨害安全驾驶罪，行为，危及公共安全)

**（5）逆向提示法**
逆向提示法通过分析大模型输出结果要求返回有关输入的提示，帮助用户构建需要的输入内容，指导大模型生成所需的回答。
- **示例1**：提示是在使用大模型时，为了引导大模型输出特定的答案或生成特定的内容，使用的特定文本提示。你是一名经验丰富的大模型提示工程师，请分析以下代码的语言、框架、逻辑，推理出编码的需求，并基于分析结果，给出可以让大模型生成以下完整代码的中文提示。
  - 代码内容如下：
```python
# This is a sample Python script.
import numpy as np
def print_hi(name):
    # Use a breakpoint in the code line below to debug your script.
    print(f'Hi, {name}')
# Press the green button in the gutter to run the script.
if __name__ == '__main__':
    print_hi('PyCharm')
    mat3 = np.full(shape=(2, 2, 3), fill_value=1)  # 生成一个2*2*3的数组，元素的值全为1
    print('值全为1的2*2*3的数组: \n', mat3)
```
  - 输出：
    - 1）需求分析：
需要生成一个2*2*3的数组，元素的值全为1。
使用NumPy库的full函数来实现。
    - 2）中文提示：
请编写一个Python脚本，使用NumPy库生成一个2*2*3的数组，元素的值全为1。
- **示例2**：我需要给你提供哪些信息，以便你能输出技术调研报告，报告内容包括从一些关键维度对多项技术进行对比分析，并结合应用场景，给出使用建议。
  - 输出：
为了输出技术调研报告，我需要以下信息。
    - 1）技术列表：请提供你想要对比分析的技术列表。这些技术可以是软件框架、编程语言、数据库系统、云服务等。
    - 2）关键维度：请提供你希望从哪些关键维度对这些技术进行对比分析。这些维度可能包括性能、可扩展性、易用性、社区支持、成本、兼容性等。
    - 3）应用场景：请描述你希望将这些技术应用到的具体场景。这将帮助我为你提供更具针对性的使用建议。
    - 4）需求和限制：请提供你在技术选型过程中需要考虑的需求和限制，例如预算、团队技能、项目周期等。
    - 5）优先级：如果有多个关键维度，请告诉我它们之间的优先级顺序，以便我在提供使用建议时能够更加关注你关心的方面。
    - 6）现有系统和技术栈(可选)：如果你已经有了现有的系统和技术栈，请提供相关信息，以便我能够更好地为你推荐合适的技术。
请提供以上信息，我将根据你的需求生成技术调研报告。

#### 2. 思维链提示

思维链（Chain of Thought，CoT）提示旨在以一连串短句逐步描述推理逻辑，即给出推理链或理由，最终得出答案。在使用大模型处理任务时，简单的任务只能从思维链提示中略微受益，而复杂的逻辑推理任务益处更加显著。思维链提示主要有两种类型：零样本思维链（Zero-Shot Chain of Thought）和少样本思维链（Few-Shot Chain of Thought）。

**（1）零样本思维链**

零样本学习（Zero-Shot Learning）是指通过计算机模拟人类的推理方式来识别从未见过的新事物。在零样本学习中，人们不需要向大模型提供任何标注数据，而是期望模型能够处理全新的问题。

在大模型对话场景中，可以通过提供适当的指令对新任务进行零样本提示。大模型能够理解来自许多资源的内容，以应对未知问题。

以星火大模型为例，在情感分析、问题解答、机器翻译等场景的零样本提示示例如下。
- **情感分析**
  - 输入：将文本分为中性、否定或肯定三类。文本：我觉得假期很糟糕。请输出观点。
  - 输出：观点——否定。
- **问题解答**
  - 输入：回答这个问题——什么不能消除浪费？(A) 植物 (B) 蘑菇 (C) 细菌 (D) 机器人。
  - 输出：机器人 (D) 是不能消除浪费的选项，因为它们缺乏自然分解能力，且其制造和运行过程中可能产生额外的资源消耗和废物。
- **机器翻译**
  - 输入：Translate the following English sentence into Chinese: "The big language model has become a hot development direction in the field of artificial intelligence."
  - 输出：大语言模型已经成为AI领域的热门发展方向。


在上述一系列提示中，未向大模型提供任何范例。然而，大模型已成功理解需求，这是零样本学习能力发挥作用的典型案例。

零样本思维链可以使用自然语言语句明确表示需要按照步骤执行。如“让我们一步步地思考”，明确鼓励大模型首先生成推理链，然后用“因此，答案是”去生成答案。或者使用类似的语句：“让我们一步步地解决这个问题，以确保得出正确的答案”。

在向模型提出逻辑推理问题时，大模型往往会返回错误的答案。然而，当在问题末尾添加“让我们一步步地思考”这一句话之后，模型能够显示推理的过程。

接下来以星火大模型为例，通过更多示例来演示零样本思维链提示的推理过程。

- **示例**：小星是一名程序员。他需要买两双袜子和一双休闲鞋。每双袜子售价5元，休闲鞋售价200元。小星有150元，还需要多少钱？让我们一步步地解决这个问题，以确保有正确的答案。




输出：首先，我们需要计算两双袜子的总价。每双袜子售价5元，所以两双袜子的总价是5×2 = 10元。

接下来，我们需要计算购买两双袜子和一双休闲鞋所需的总金额。休闲鞋售价200元，所以总金额是10 + 200 = 210元。

最后，我们需要计算小星还需要多少钱。小星有150元，所以他还需要210 - 150 = 60元。 


以上提示不向模型展示样例，而是引导大模型一步步地解决这个问题。人们可以观察到，大模型能够进行逐步推理，并最终得出正确答案。

进一步，当零样本学习无法达到预期效果时，我们可以在提示中提供示范或实例，以实现少样本提示的目标。

**（2）少样本思维链**

少样本学习（Few-shot Learning）作为一种高效的情境学习技术，其精髓在于通过在输入提示中嵌入精选的示例，来激发模型的类比推理能力，从而促使模型在处理相似或相关任务时展现出更卓越的效果。这些示范性实例充当了条件信号的角色，旨在引导模型理解和应用隐含的规则或模式，使其能够在面对新颖但相关的后续示例时，生成恰当且准确的响应，而无须额外的训练或参数调整。这种方式不仅强化了模型的适应性和泛化能力，还极大简化了在新领域部署模型的过程。

相比传统的小样本学习技术，当面对新任务时，少样本学习无须对大模型进行大规模的微调即可有效利用极有限的示例。这一革新极大地减轻了对庞大数据集人工标注的依赖，赋予大模型迅速适应新情境的能力，并确保即使在数据稀缺的情况下也能对新兴类别作出精准的预测。这种学习范式不仅提升了大模型的泛化能力，还大幅降低了获取大量标注数据的成本，使大模型有可能适应实时更新和不断变化的任务环境。

下面以星火大模型为例介绍少样本提示在情感分析、问题解答场景下的应用。

- **情感分析**
  - 提示：
    - 这太棒了！//积极乐观的
    - 这太糟糕了！//消极的
  - 输入：多么精彩的表演！
  - 输出：积极的
- **问题解答**
  - 提示：
    - Q：以下哪种生物会以鱼为食，并且生活在沼泽地？(A) 一棵树 (B) 一头鲸鱼 (C) 一头野猪 (D) 一只短吻鳄
    - A：(D) 短吻鳄。短吻鳄是半水生爬行动物，非常适合生活在沼泽和河流等湿地栖息地。它们是机会主义式的捕食者，会吃掉各种猎物，包括鱼类、海龟、鸟类和哺乳动物。
  - 输入：
    - Q：什么不能消除浪费？(A) 植物 (B) 蘑菇 (C) 细菌 (D) 机器人
  - 输出：
    - (D) 机器人。机器人是由人类设计和制造的技术产品，它们没有自然的代谢或分解功能。机器人本身无法处理或消除任何形式的浪费；相反，如果设计不当或维护不良，机器人还可能成为环境负担。

通过向模型提供一个示例，我们可以观察到模型在某种程度上已经掌握了任务执行的能力。对于较为困难的任务，可以尝试增加示例的个数，例如3个、5个或者10个等。虽然少样本学习与零样本学习技术在利用示例上都有出色的表现，但总体而言，少样本学习的性能要优于零样本学习。

少样本思维链会向大模型展示一些少量的示例，并在示例中解释推理过程。大模型在回答提示时也会显示推理过程。这种推理过程的解释会引导出更准确的结果。

在常规的提示下，大模型可能会给出错误的回答。然而，当人们在提示中向大模型展示了类似的示例后，大模型学会了逐步推理并最终给出了正确的答案。

接下来，以星火大模型为例，通过更多示例来进一步演示少样本思维链提示。

- **提示**：
  - 这组中的奇数加起来，结果是偶数：16、11、14、4、8、13、24。
  - 回答：将所有奇数（11、13）相加得到24。答案是正确的。
  - 这组中的奇数加起来，结果就是偶数：17、9、10、12、13、4、2。
  - 回答：将所有奇数（17、9、13）相加得到39。答案是错误的。
- **输入**：
  - 这组中的奇数加起来，结果是偶数：15、32、5、13、82、7、1。
- **输出**：
  - 将所有奇数（15、5、13、7、1）相加得到41。答案是错误的。

### 2.6 本章小结
本章首先介绍了大模型的构建流程，涉及预训练语言模型、有监督的模型微调以及RLHF。接下来，针对各个阶段的工作展开讲解Transformer模型架构及主要的组成技术。之后重点讲解了对齐优化技术，以及提示工程相关的流程和提示设计开发技术。 
